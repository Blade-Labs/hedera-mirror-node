# Disable so flux doesn't rollout
#apiVersion: helm.fluxcd.io/v1
#kind: HelmRelease
metadata:
  name: mirror
  namespace: integration
spec:
  chart:
    git: https://github.com/hashgraph/hedera-mirror-node.git
    path: charts/hedera-mirror
    ref: tags/v0.26.0-alpha1
  rollback:
    enable: true
    force: true
    timeout: 500
    wait: false
  timeout: 500
  wait: false
  values:
    global:
      db:
        host: RELEASE-NAME-timescaledb
    grpc:
      prometheusRules:
        GrpcNoSubscribers:
          enabled: false
    importer:
      config:
        hedera:
          mirror:
            importer:
              db:
                owner: mirror_node
                schema: mirrornode
                username: mirror_importer
              downloader:
                cloudProvider: S3
              initialAddressBook: "/usr/etc/addressbook/addressbook.bin"
              network: OTHER
              startDate: 1970-01-01T00:00:00Z
        spring:
          flyway:
            baselineVersion: 1.999.999
            locations: "classpath:db/migration/v2"
            target: 2.999.999
      extraVolumeMounts:
        - name: addressbook
          mountPath: /usr/etc/addressbook
      extraVolumes:
        - name: addressbook
          secret:
            defaultMode: 420
            secretName: mirror-importer-addressbook
      replicas: 0
    monitor:
      config:
        hedera:
          mirror:
            monitor:
              mirrorNode:
                grpc:
                  host: integration-mirror-grpc
                rest:
                  host: integration-mirror-rest
                  port: 80
              network: OTHER
    postgresql:
      enabled: false
    rest:
      prometheusRules:
        RestNoRequests:
          enabled: false
    timescaledb:
      enabled: true
  valuesFrom:
    - chartFileRef:
        path: values-prod.yaml
    - secretKeyRef:
        name: mirror

